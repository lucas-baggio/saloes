<div class="px-4 sm:px-6 lg:px-8 py-4 sm:py-6 max-w-4xl mx-auto">
  <!-- Header -->
  <div class="mb-6">
    <button
      (click)="goBack()"
      class="flex items-center text-gray-600 hover:text-gray-900 mb-4"
    >
      <svg
        class="h-5 w-5 mr-2"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M15 19l-7-7 7-7"
        />
      </svg>
      Voltar para planos
    </button>
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Pagamento</h1>
    <p class="mt-1 sm:mt-2 text-xs sm:text-sm text-gray-600">
      Complete seu pagamento para ativar o plano
    </p>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-12">
    <div
      class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"
    ></div>
    <p class="mt-2 text-gray-600">Carregando informações do plano...</p>
  </div>

  <!-- Success Message -->
  <div
    *ngIf="showSuccess"
    class="mb-6 bg-green-50 border border-green-200 rounded-lg p-6 text-center"
  >
    <svg
      class="mx-auto h-12 w-12 text-green-500 mb-4"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
      />
    </svg>
    <h3 class="text-lg font-semibold text-green-900 mb-2">
      Pagamento Aprovado!
    </h3>
    <p class="text-sm text-green-700">
      Seu plano foi ativado com sucesso. Redirecionando...
    </p>
  </div>

  <!-- Payment Form -->
  <div
    *ngIf="!loading && plan && !showSuccess"
    class="grid grid-cols-1 lg:grid-cols-3 gap-6"
  >
    <!-- Resumo do Plano -->
    <div class="lg:col-span-1">
      <div class="card">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">
          Resumo do Plano
        </h2>
        <div class="space-y-3">
          <div>
            <p class="text-sm text-gray-600">Plano</p>
            <p class="text-lg font-semibold text-gray-900">{{ plan.name }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-600">Período</p>
            <p class="text-base text-gray-900">
              {{ plan.interval === "monthly" ? "Mensal" : "Anual" }}
            </p>
          </div>
          <div class="pt-3 border-t border-gray-200">
            <p class="text-sm text-gray-600">Total</p>
            <p class="text-2xl font-bold text-gray-900">
              R$ {{ plan.price | number : "1.2-2" }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Formulário de Pagamento -->
    <div class="lg:col-span-2">
      <div class="card">
        <h2 class="text-lg font-semibold text-gray-900 mb-6">
          Escolha a forma de pagamento
        </h2>

        <form [formGroup]="paymentForm" (ngSubmit)="processPayment()">
          <!-- Método de Pagamento PIX -->
          <div class="mb-6">
            <label
              class="relative flex flex-col items-center p-4 border-2 rounded-lg border-primary-500 bg-primary-50 cursor-pointer transition-all"
            >
              <input
                type="radio"
                formControlName="payment_method"
                value="pix"
                class="sr-only"
                checked
              />
              <svg
                class="h-8 w-8 mb-2 text-primary-600"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                />
              </svg>
              <span class="text-sm font-medium text-gray-900">PIX</span>
              <span class="text-xs text-gray-500 mt-1">Aprovação imediata</span>
            </label>
          </div>

          <!-- Botão de Pagamento -->
          <button
            type="submit"
            [disabled]="processing"
            class="btn btn-primary w-full text-base py-3"
          >
            <span *ngIf="!processing">Gerar QR Code PIX</span>
            <span *ngIf="processing" class="flex items-center justify-center">
              <svg
                class="animate-spin -ml-1 mr-3 h-5 w-5 text-white"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
              Processando...
            </span>
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Resultado do Pagamento -->
  <div *ngIf="paymentResponse && !showSuccess" class="mt-6">
    <!-- PIX QR Code -->
    <div *ngIf="selectedMethod === 'pix'" class="card">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Pagamento PIX</h3>
      <div class="flex flex-col items-center">
        <!-- QR Code Base64 (Imagem) -->
        <div
          *ngIf="paymentResponse.qr_code_base64"
          class="mb-4 p-4 bg-white rounded-lg border-2 border-gray-200"
        >
          <img
            [src]="paymentResponse.qr_code_base64"
            alt="QR Code PIX"
            class="w-64 h-64"
          />
        </div>

        <!-- Mensagem quando não tem QR Code ainda -->
        <div
          *ngIf="!paymentResponse.qr_code && !paymentResponse.qr_code_base64"
          class="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg w-full"
        >
          <p class="text-sm text-yellow-800">
            <strong>Aguardando geração do QR Code...</strong><br />
            O pagamento foi criado. Aguarde alguns instantes enquanto o Mercado
            Pago gera o QR Code.
          </p>
        </div>

        <!-- Código PIX (Copiar e Colar) -->
        <div *ngIf="paymentResponse.qr_code" class="w-full max-w-md mt-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Código PIX (Copiar e Colar)
          </label>
          <div class="flex gap-2">
            <textarea
              [value]="paymentResponse.qr_code"
              readonly
              rows="4"
              class="input flex-1 font-mono text-xs resize-none break-all"
            ></textarea>
            <button
              (click)="copyToClipboard(paymentResponse.qr_code || '')"
              class="btn btn-secondary whitespace-nowrap"
            >
              Copiar
            </button>
          </div>
          <p class="text-xs text-gray-500 mt-2">
            Cole este código no app do seu banco para pagar via PIX
          </p>
        </div>
      </div>
    </div>

    <!-- Boleto -->
    <div
      *ngIf="selectedMethod === 'boleto' && paymentResponse.barcode"
      class="card"
    >
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Boleto Bancário</h3>
      <div class="space-y-4">
        <div
          *ngIf="paymentResponse.barcode_base64"
          class="flex justify-center p-4 bg-white rounded-lg border-2 border-gray-200"
        >
          <img
            [src]="paymentResponse.barcode_base64"
            alt="Código de Barras"
            class="max-w-full h-auto"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Código de Barras
          </label>
          <div class="flex gap-2">
            <input
              type="text"
              [value]="paymentResponse.barcode"
              readonly
              class="input flex-1 font-mono text-xs"
            />
            <button
              (click)="copyToClipboard(paymentResponse.barcode || '')"
              class="btn btn-secondary whitespace-nowrap"
            >
              Copiar
            </button>
          </div>
        </div>
        <div
          *ngIf="paymentResponse.due_date"
          class="bg-yellow-50 border border-yellow-200 rounded-lg p-4"
        >
          <p class="text-sm text-yellow-800">
            <strong>Vencimento:</strong>
            {{ paymentResponse.due_date | date : "dd/MM/yyyy" }}
          </p>
        </div>
        <div class="flex gap-2">
          <button (click)="downloadBoleto()" class="btn btn-secondary flex-1">
            Baixar Boleto
          </button>
        </div>
      </div>
    </div>

    <!-- Status do Pagamento -->
    <div
      *ngIf="paymentResponse.status === 'processing'"
      class="card bg-blue-50 border border-blue-200"
    >
      <div class="flex items-center">
        <svg
          class="animate-spin h-5 w-5 text-blue-600 mr-3"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"
          ></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          ></path>
        </svg>
        <div>
          <p class="text-sm font-medium text-blue-900">
            Processando pagamento...
          </p>
          <p class="text-xs text-blue-700">
            Aguarde enquanto processamos sua transação.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
